<template name="messages">
  {{#if currentUser}}
    <div class="container">
      <div class="row" style="margin-bottom:20px;">
        <form class="newConversation">
          <div class="col-xs-5 col-xs-offset-7 input-group">
              <input type="text" name="username" placeholder="Enter a user's username and start a conversation!" class="form-control">
              <span class="input-group-btn">
                  <button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-plus glyph-white"></span></button>
              </span>
          </div>
        </form>
      </div>
      {{#if hasConversations}}
        {{#each currentUser.conversations}}
          <div class="row">
            <div class="col-xs-12">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <div class="row">
                    <div class="col-lg-1">
                      {{#each participants}}
                        {{#if ../isUnread}}
                          <h4><a href={{pathToUserProfile}}>{{user.username}}</a><span class="glyphicon glyphicon-envelope glyph-red"></span></h4>
                        {{else}}
                          <h4><a href={{pathToUserProfile}}>{{user.username}}</a></h4>
                        {{/if}}
                      {{/each}}
                    </div>
                    <div class="col-lg-1 col-lg-offset-10">
                      <button class="btn-danger btn deleteConversation">Delete</button>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="conversation panel-body">
                    {{#with lastMessage}}
                      <div class="col-xs-1">
                          <h4>{{user.username}}:</h4>
                      </div>
                      <div class="col-xs-11">
                          <h4 class="lastMessageBody">{{body}}</h4>
                      </div>
                    {{/with}}
                  </div>
                </div>
              </div>
            </div>
          </div>
        {{/each}}
      {{else}}
        <div class="row">
          <div class="alert alert-warning text-center">
              <p class="lead">Looks like you don't have any conversations! Try searching for some books above.</p>
          </div>
        </div>
        <div class="row">
          <div class="alert alert-warning text-center">
              <p class="lead">When your book request is accepted, a conversation will begin between you and the book's owner.</p>
          </div>
        </div>
      {{/if}}
    </div>
  {{/if}}
</template>